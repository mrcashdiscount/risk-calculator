<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Risk Provisional Compliance Score Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #EF4444; /* Red 500 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9;
        }
        .step-indicator.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        .input-radio:checked + label {
            border-color: var(--primary-color);
            background-color: #FEF2F2; /* Red 50 */
            color: #EF4444;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: var(--primary-color);
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #DC2626; /* Red 600 */
        }
        .shadow-custom {
            box-shadow: 0 20px 25px -5px rgba(239, 68, 68, 0.1), 0 8px 10px -6px rgba(239, 68, 68, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app-container" class="w-full max-w-2xl bg-white rounded-xl shadow-2xl shadow-gray-300 p-8 md:p-12 transition-all duration-300">

        <!-- Header / Above the Fold Copy -->
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 leading-tight">
                Stop Losing Money to Hidden Fees and Account Holds.
            </h1>
            <h2 class="mt-3 text-xl font-medium text-gray-600">
                Instantly Calculate Your **Provisional Compliance Score** and Discover Your True High-Risk Processing Rate.
            </h2>
            <p class="mt-6 text-sm text-gray-500 max-w-md mx-auto">6 Questions. Less than 5 minutes.</p>
        </header>

        <!-- Progress Indicator -->
        <div id="progress-bar" class="flex justify-between items-center mb-8">
            <!-- Steps will be generated here by JS -->
        </div>

        <!-- Calculator Form -->
        <form id="riskForm" class="space-y-6">
            <!-- Step 1: Vertical Risk -->
            <div data-step="1" class="step">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Question 1/6: Primary Vertical Risk</h3>
                <p class="text-gray-600 mb-6">Which best describes your primary product or service vertical?</p>
                <div class="space-y-4">
                    <input type="radio" id="vape" name="vertical" value="vape" class="hidden input-radio" required>
                    <label for="vape" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">Smoke/Vape/CBD (High Liability)</label>

                    <input type="radio" id="nutra" name="vertical" value="nutra" class="hidden input-radio">
                    <label for="nutra" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">Nutraceuticals/Supplements (High Dispute Risk)</label>

                    <input type="radio" id="subs" name="vertical" value="subs" class="hidden input-radio">
                    <label for="subs" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">Recurring Subscriptions (General)</label>
                    
                    <input type="radio" id="debt" name="vertical" value="debt" class="hidden input-radio">
                    <label for="debt" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">Debt Collection/Adult Entertainment (Critical Risk)</label>
                    
                    <input type="radio" id="ecomm" name="vertical" value="ecomm" class="hidden input-radio">
                    <label for="ecomm" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">High-Ticket E-commerce/Other (Standard High-Risk)</label>
                </div>
            </div>

            <!-- Step 2: Processing Volume -->
            <div data-step="2" class="step hidden">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Question 2/6: Processing Volume</h3>
                <p class="text-gray-600 mb-6">What is your estimated average monthly processing volume (USD)?</p>
                <div class="space-y-4">
                    <input type="radio" id="vol1" name="volume" value="<25k" class="hidden input-radio" required>
                    <label for="vol1" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">< $25K</label>
                    
                    <input type="radio" id="vol2" name="volume" value="25k-100k" class="hidden input-radio">
                    <label for="vol2" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">$25K - $100K</label>
                    
                    <input type="radio" id="vol3" name="volume" value="100k-250k" class="hidden input-radio">
                    <label for="vol3" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">$100K - $250K</label>
                    
                    <input type="radio" id="vol4" name="volume" value=">250k" class="hidden input-radio">
                    <label for="vol4" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">> $250K (High Exposure)</label>
                </div>
            </div>

            <!-- Step 3: Subscription Percentage -->
            <div data-step="3" class="step hidden">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Question 3/6: Subscription Model</h3>
                <p class="text-gray-600 mb-6">What percentage of your sales are based on a recurring/subscription model?</p>
                <div class="space-y-4">
                    <input type="radio" id="sub0" name="sub_percent" value="0%" class="hidden input-radio" required>
                    <label for="sub0" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">0% (None)</label>
                    
                    <input type="radio" id="sub25" name="sub_percent" value="<50%" class="hidden input-radio">
                    <label for="sub25" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">< 50%</label>
                    
                    <input type="radio" id="sub75" name="sub_percent" value="50-75%" class="hidden input-radio">
                    <label for="sub75" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">50% - 75%</label>
                    
                    <input type="radio" id="sub100" name="sub_percent" value=">75%" class="hidden input-radio">
                    <label for="sub100" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">> 75% (High Liability)</label>
                </div>
            </div>

            <!-- Step 4: ID Verification -->
            <div data-step="4" class="step hidden">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Question 4/6: Compliance Check</h3>
                <p class="text-gray-600 mb-6">Do you currently have compliant Age/Identity Verification (e.g., AVS, third-party ID check) integrated *before* payment on all restricted sales?</p>
                <div class="space-y-4">
                    <input type="radio" id="id_yes" name="id_check" value="yes" class="hidden input-radio" required>
                    <label for="id_yes" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">Yes, fully compliant</label>
                    
                    <input type="radio" id="id_no" name="id_check" value="no" class="hidden input-radio">
                    <label for="id_no" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">No, or only partial coverage (High Gap Risk)</label>
                    
                    <input type="radio" id="id_na" name="id_check" value="na" class="hidden input-radio">
                    <label for="id_na" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">Not Applicable (NA)</label>
                </div>
            </div>

            <!-- Step 5: Chargeback Ratio -->
            <div data-step="5" class="step hidden">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Question 5/6: Chargeback Ratio</h3>
                <p class="text-gray-600 mb-6">What is your current estimated monthly Chargeback Ratio? (Disputes รท Total Transactions)</p>
                <div class="space-y-4">
                    <input type="radio" id="cb1" name="cb_ratio" value="<0.5%" class="hidden input-radio" required>
                    <label for="cb1" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">< 0.5% (Stable)</label>
                    
                    <input type="radio" id="cb2" name="cb_ratio" value="0.5%-0.9%" class="hidden input-radio">
                    <label for="cb2" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">0.5% - 0.9% (Elevated Risk)</label>
                    
                    <input type="radio" id="cb3" name="cb_ratio" value="1.0%-1.5%" class="hidden input-radio">
                    <label for="cb3" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">1.0% - 1.5% (Warning Zone - Crisis Imminent)</label>
                    
                    <input type="radio" id="cb4" name="cb_ratio" value=">1.5%" class="hidden input-radio">
                    <label for="cb4" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition duration-200 text-gray-700 font-medium hover:border-red-400">> 1.5% (Critical Zone - Immediate Intervention Needed)</label>
                </div>
            </div>

            <!-- Step 6: AOV & Lead Capture -->
            <div data-step="6" class="step hidden">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Question 6/6: Average Order Value & Report Delivery</h3>
                <p class="text-gray-600 mb-6">What is your estimated Average Dollar Amount Per Transaction (AOV)?</p>
                <div class="mb-6">
                    <label for="aov" class="block text-sm font-medium text-gray-700 mb-2">AOV (USD):</label>
                    <input type="number" id="aov" name="aov" min="1" placeholder="e.g., 75.00" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" required>
                </div>
                
                <p class="text-gray-600 mb-6">To receive your full **Provisional Compliance Score**, estimated rate, and a custom **3-Step Mitigation Plan**, please enter your email.</p>
                <div class="mb-6">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Work Email Address:</label>
                    <input type="email" id="email" name="email" placeholder="you@yourbusiness.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" required>
                </div>
            </div>


            <!-- Navigation & Loading -->
            <div id="nav-buttons" class="mt-8 flex justify-between">
                <button type="button" id="backBtn" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-semibold hover:bg-gray-100 transition duration-200 disabled:opacity-50" disabled>
                    &larr; Back
                </button>
                <button type="button" id="nextBtn" class="px-6 py-3 btn-primary text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition duration-200">
                    Next &rarr;
                </button>
                <button type="submit" id="submitBtn" class="px-6 py-3 btn-primary text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition duration-200 hidden">
                    Calculate My Score
                </button>
            </div>
            
            <div id="loadingMessage" class="hidden text-center mt-6">
                <div class="animate-spin inline-block w-6 h-6 border-4 border-red-500 border-t-transparent rounded-full"></div>
                <p class="mt-2 text-red-500 font-medium">Analyzing risk profile... Please wait.</p>
            </div>
        </form>

        <!-- Results Screen (Hidden initially) -->
        <div id="resultsScreen" class="hidden text-center p-8">
            <h3 class="text-3xl font-extrabold text-gray-900 mb-6">Your Risk Assessment is Complete!</h3>
            
            <div class="mb-8 p-6 bg-red-50 rounded-xl border border-red-200">
                <p class="text-xl font-medium text-gray-700">Your Provisional Compliance Score (PCS):</p>
                <div id="pcsDisplay" class="text-6xl font-black mt-2 inline-block px-6 py-3 rounded-xl shadow-custom text-white bg-red-500">
                    --
                </div>
                <p id="riskSummary" class="mt-4 text-red-700 font-semibold"></p>
            </div>

            <div class="text-left space-y-6">
                <h4 class="text-2xl font-bold text-gray-800 border-b pb-2">Your Custom Mitigation Plan</h4>
                
                <div id="mitigationPlan">
                    <!-- Mitigation plan will be inserted here by JS -->
                </div>

                <div class="pt-4 border-t mt-6">
                    <h4 class="text-xl font-bold text-gray-800 mb-2">Estimated Interchange-Plus Rate:</h4>
                    <p id="rateEstimate" class="text-2xl font-semibold text-green-600">--</p>
                </div>

                <p class="text-sm text-gray-500 mt-6">A full report will be sent to your email with a dedicated risk analyst's findings.</p>
            </div>
        </div>

    </div>

    <script>
        // Set the current step and total steps
        let currentStep = 1;
        const totalSteps = 6;
        const form = document.getElementById('riskForm');
        const steps = form.querySelectorAll('.step');
        const nextBtn = document.getElementById('nextBtn');
        const backBtn = document.getElementById('backBtn');
        const submitBtn = document.getElementById('submitBtn');
        const loadingMessage = document.getElementById('loadingMessage');
        const resultsScreen = document.getElementById('resultsScreen');
        const appContainer = document.getElementById('app-container');

        // --- Core Functions ---

        /**
         * Generates and updates the progress bar indicators.
         */
        function updateProgressBar() {
            const progressBar = document.getElementById('progress-bar');
            progressBar.innerHTML = ''; // Clear existing indicators
            for (let i = 1; i <= totalSteps; i++) {
                const isActive = i <= currentStep;
                const indicator = document.createElement('div');
                indicator.className = `step-indicator w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm border-2 transition-colors duration-300 ${isActive ? 'active' : 'bg-gray-100 text-gray-400 border-gray-300'}`;
                indicator.textContent = i;
                progressBar.appendChild(indicator);
            }
        }

        /**
         * Shows the current form step and hides all others.
         */
        function showStep(stepIndex) {
            steps.forEach(step => {
                step.classList.add('hidden');
            });
            const current = form.querySelector(`[data-step="${stepIndex}"]`);
            if (current) {
                current.classList.remove('hidden');
            }

            // Navigation button logic
            backBtn.disabled = stepIndex === 1;
            
            if (stepIndex === totalSteps) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }

            updateProgressBar();
        }

        /**
         * Validates the current step before moving next.
         */
        function validateCurrentStep() {
            const currentStepElement = form.querySelector(`[data-step="${currentStep}"]`);
            const requiredInputs = currentStepElement.querySelectorAll('input[required], input[type="radio"]');
            let isValid = true;

            requiredInputs.forEach(input => {
                // Check radio buttons (only one needs to be checked per group)
                if (input.type === 'radio') {
                    const groupName = input.name;
                    if (!form.querySelector(`input[name="${groupName}"]:checked`)) {
                        isValid = false;
                    }
                } 
                // Check other required inputs (like email/AOV on step 6)
                else if (input.hasAttribute('required') && !input.value) {
                    isValid = false;
                }
            });

            if (!isValid) {
                // Simple visual feedback for missing required fields
                alert('Please select an option or fill in the required field to continue.');
            }
            return isValid;
        }

        /**
         * Moves to the next step.
         */
        function nextStep() {
            if (validateCurrentStep() && currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            }
        }

        /**
         * Moves to the previous step.
         */
        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }
        
        // --- PCS Calculation Logic ---
        
        /**
         * Calculates the Provisional Compliance Score (PCS) and risk metrics.
         */
        function calculatePCS(formData) {
            let pcs = 100; // Start at 100 points (low risk)
            let riskSummary = "Stable and Optimized (Tier 3)";
            let rateEstimate = "IC + 0.15% + $0.15 (Waived Reserve)";
            let mitigationPlan = [
                "**Goal: Profit Optimization.** Maintain a clean compliance record. Focus on scaling.",
                "Review the Dual Pricing/Cash Discount model to move your effective rate to 0% and maximize savings.",
                "Consider setting up a **Multi-MID structure** for future scaling and risk diversification."
            ];

            // 1. Vertical Risk (Q1)
            switch (formData.get('vertical')) {
                case 'vape': // Smoke/Vape/CBD
                    pcs -= 15;
                    mitigationPlan[0] = "**Goal: Compliance Rigor.** Immediate need for explicit Age Verification and geographic compliance checks.";
                    break;
                case 'nutra': // Nutraceuticals/Supplements
                    pcs -= 10;
                    mitigationPlan[0] = "**Goal: Claims & Dispute Management.** Must review all product claims to meet bank underwriting standards.";
                    break;
                case 'debt': // Debt Collection/Adult
                    pcs -= 25;
                    mitigationPlan[0] = "**Goal: Critical Account Rescue.** Specialized banking is non-negotiable. Requires high-level regulatory expertise.";
                    break;
                case 'subs': // Recurring Subscriptions
                    pcs -= 5;
                    break;
            }

            // 2. Volume Risk (Q2)
            if (formData.get('volume') === '>250k') {
                pcs -= 10;
            } else if (formData.get('volume') === '100k-250k') {
                pcs -= 5;
            }

            // 3. Subscription % (Q3)
            if (formData.get('sub_percent') === '>75%') {
                pcs -= 10;
            } else if (formData.get('sub_percent') === '50-75%') {
                pcs -= 5;
            }

            // 4. ID Verification Status (Q4)
            if (formData.get('id_check') === 'no') {
                pcs -= 15; // Major compliance gap
                mitigationPlan.push("MANDATORY: Implement a compliant third-party Age/ID verification layer immediately.");
            }

            // 5. Chargeback Ratio (Q5) - Most influential factor
            const cbRatio = formData.get('cb_ratio');
            if (cbRatio === '>1.5%') {
                pcs -= 30; // Critical Crisis
            } else if (cbRatio === '1.0%-1.5%') {
                pcs -= 15; // Warning Zone
            } else if (cbRatio === '0.5%-0.9%') {
                pcs -= 5; // Elevated Risk
            }

            // Cap the PCS score at 100 and ensure it doesn't go below 1 (though logic should keep it non-negative)
            pcs = Math.max(1, Math.min(100, pcs));

            // --- Triage Tier Determination & Final Offer ---
            
            if (pcs < 50) {
                riskSummary = "CRITICAL RISK (Tier 1) - IMMEDIATE INTERVENTION REQUIRED";
                rateEstimate = "IC + 0.55% + $0.30 (8% Rolling Reserve)";
                mitigationPlan.unshift("**CRISIS ALERT:** Your account is at immediate risk of termination or freeze. Stabilization is the priority.");
                mitigationPlan.push("MANDATORY: Integrate a **Real-Time Dispute Prevention (CDR)** service to stop chargebacks before they hit the bank.");

            } else if (pcs < 75) {
                riskSummary = "ELEVATED RISK (Tier 2) - VULNERABLE";
                rateEstimate = "IC + 0.35% + $0.20 (3% Rolling Reserve)";
                mitigationPlan.unshift("**WARNING:** You have compliance gaps that will lead to higher fees and potential future account instability.");
                mitigationPlan.push("RECOMMENDED: Set up basic fraud velocity filters and enhance your AVS/CVV checks.");
            }

            return { pcs, riskSummary, rateEstimate, mitigationPlan };
        }
        
        /**
         * Handles the final form submission, calculates results, and simulates lead capture.
         */
        function handleSubmit(event) {
            event.preventDefault();
            if (!validateCurrentStep()) return;
            
            form.classList.add('hidden');
            loadingMessage.classList.remove('hidden');
            
            const formData = new FormData(form);
            const leadEmail = formData.get('email');
            
            // 1. Calculate the Results
            const results = calculatePCS(formData);

            // 2. Simulate Lead Capture (replace this with your actual CRM fetch)
            console.log("--- LEAD CAPTURE DATA (CRM SIMULATION) ---");
            console.log("Email:", leadEmail);
            console.log("PCS Score:", results.pcs);
            console.log("Triage Tier:", results.riskSummary.split(' - ')[0]);
            console.log("Form Data:", Object.fromEntries(formData));

            // Simulating a network delay for a more realistic user experience
            setTimeout(() => {
                loadingMessage.classList.add('hidden');
                displayResults(results);
            }, 1500);
        }
        
        /**
         * Displays the final results screen.
         */
        function displayResults(results) {
            appContainer.classList.add('shadow-custom'); // Add visual emphasis to results card
            
            // Set the Risk Summary Color
            let bgColor = 'bg-green-500';
            let textColor = 'text-green-700';
            
            if (results.pcs < 50) {
                bgColor = 'bg-red-500';
                textColor = 'text-red-700';
            } else if (results.pcs < 75) {
                bgColor = 'bg-yellow-500';
                textColor = 'text-yellow-700';
            }

            document.getElementById('pcsDisplay').textContent = results.pcs;
            document.getElementById('pcsDisplay').classList.remove('bg-red-500');
            document.getElementById('pcsDisplay').classList.add(bgColor);
            
            document.getElementById('riskSummary').textContent = results.riskSummary;
            document.getElementById('riskSummary').classList.remove('text-red-700');
            document.getElementById('riskSummary').classList.add(textColor);

            document.getElementById('rateEstimate').textContent = results.rateEstimate;
            
            // Build the Mitigation Plan
            const planList = document.getElementById('mitigationPlan');
            planList.innerHTML = '';
            results.mitigationPlan.forEach((point, index) => {
                const item = document.createElement('div');
                item.className = 'flex items-start space-x-3';
                item.innerHTML = `
                    <div class="flex-shrink-0 w-6 h-6 bg-red-100 text-red-600 rounded-full flex items-center justify-center font-bold text-xs">${index + 1}</div>
                    <p class="text-gray-700 flex-1">${point}</p>
                `;
                planList.appendChild(item);
            });


            resultsScreen.classList.remove('hidden');
        }

        // --- Event Listeners and Initialization ---

        nextBtn.addEventListener('click', nextStep);
        backBtn.addEventListener('click', prevStep);
        form.addEventListener('submit', handleSubmit);

        // Allow navigation using the Enter key (on inputs)
        form.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                if (currentStep < totalSteps) {
                    nextStep();
                } else if (!submitBtn.classList.contains('hidden')) {
                    handleSubmit(e);
                }
            }
        });

        // Initialize the first step and progress bar
        window.onload = function() {
            showStep(currentStep);
        };
    </script>

</body>
</html>
